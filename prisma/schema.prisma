generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PRODUCT_CATEGORY {
  BEVERAGE
  BEER
  DRINK
  SHOT
  PORTION
  SNACK
  SANDWICH
  SKEWER
  DESSERT
  SOUP
  ADDITIONAL_SAUCE
}

enum PRODUCT_TYPE {
  RESELL
  PREPARED
}

enum MOVEMENT_TYPE {
  ENTRY
  EXIT
  ADJUST
}

enum UNIT_TYPE {
  KG
  G
  L
  ML
  UNIT
}

enum ROLE {
  ADMIN
  EMPLOYEE
}

model Product {
  id               String           @id @default(uuid()) @db.Uuid()
  name             String
  variant          String?
  measurementValue Int?
  measurementUnit  UNIT_TYPE?
  type             PRODUCT_TYPE
  category         PRODUCT_CATEGORY
  minStock         Int?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @default(now()) @updatedAt
  deletedAt        DateTime?

  movements Movement[]
  @@unique([name, measurementValue, measurementUnit])
  @@map("product")
}

model Movement {
  id            String        @id @default(uuid()) @db.Uuid()
  type          MOVEMENT_TYPE
  productId     String        @db.Uuid()
  quantity      Int
  unitCost       Decimal?      @db.Decimal(10, 2)
  unitSalePrice Decimal?      @db.Decimal(10, 2)
  userId        String        @db.Uuid()
  description   String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now()) @updatedAt
  deletedAt     DateTime?

  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@map("movement")
}

model Supply {
  id        String    @id @default(uuid()) @db.Uuid()
  name      String
  unitType  UNIT_TYPE
  minStock  Int?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now()) @updatedAt
  deletedAt DateTime?

  @@map("supply")
}

model RecipItem {
  id        String    @id @default(uuid()) @db.Uuid()
  productId String    @db.Uuid()
  supplyId  String    @db.Uuid()
  quantity  Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now()) @updatedAt
  deletedAt DateTime?

  @@map("recip_item")
}

model SupplyMovement {
  id               String        @id @default(uuid()) @db.Uuid()
  type             MOVEMENT_TYPE
  supplyId         String        @db.Uuid()
  quantity         Int           
  uniCost          Decimal?      @db.Decimal(10, 2)
  userId           String        @db.Uuid()
  description      String?
  originMovementId String?       @db.Uuid()
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @default(now()) @updatedAt
  deletedAt        DateTime?

  user User @relation(fields: [userId], references: [id])

  @@map("supply_movement")
}

model User {
  id           String    @id @default(uuid()) @db.Uuid()
  name         String
  cpf          String    @unique
  credentialId String    @db.Uuid() @unique
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now()) @updatedAt
  deletedAt    DateTime?

  credential Credential @relation(fields: [credentialId], references: [id])

  movements       Movement[]
  supplyMovements SupplyMovement[]

  @@map("user")
}

model Credential {
  id           String    @id @default(uuid()) @db.Uuid()
  email        String    @unique
  passwordHash String
  role         ROLE
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now()) @updatedAt
  deletedAt    DateTime?

  users User[]

  @@map("credential")
}
